!-------------------------------------------------------------------------------!
!  Copyright 2009-2025 Barcelona Supercomputing Center                          !
!                                                                               !
!  This file is part of the DLB library.                                        !
!                                                                               !
!  DLB is free software: you can redistribute it and/or modify                  !
!  it under the terms of the GNU Lesser General Public License as published by  !
!  the Free Software Foundation, either version 3 of the License, or            !
!  (at your option) any later version.                                          !
!                                                                               !
!  DLB is distributed in the hope that it will be useful,                       !
!  but WITHOUT ANY WARRANTY; without even the implied warranty of               !
!  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                !
!  GNU Lesser General Public License for more details.                          !
!                                                                               !
!  You should have received a copy of the GNU Lesser General Public License     !
!  along with DLB.  If not, see <https://www.gnu.org/licenses/>.                !
!-------------------------------------------------------------------------------!

#ifdef HAVE_CONFIG_H
#include <config.h>
#endif

#if defined(MPI_LIB) && defined(FORTRAN_SUPPORTS_ASSUMED_RANK)

#include "mpi/config_mpi.h"

#define CHOICE_BUFFER_TYPE TYPE(*), DIMENSION(..)

!$PYGEN start where(mpi_call.has_assumed_rank_argument)
#ifdef HAVE_{MPI_UCASE}_F08TS
subroutine {MPI_NAME}_f08ts({F08_PAR_LIST})
    use :: mpi_f08, only: {PMPI_NAME}
    {F08_USE_STMTS}
    {F08_CSHIM_USE_STMTS}

    implicit none
    {F08_PAR_DECL}

    {F08_CSHIM_LOCAL_VARS}
    integer :: f08_ierror

    interface
        subroutine DLB_{MPI_NAME}_cdesc_enter({F08_CSHIM_IFACE_PAR_LIST}) &
                bind(c, name="DLB_{MPI_NAME}_cdesc_enter")
            {F08_CSHIM_IFACE_USE_STMTS}
            implicit none
            {F08_CSHIM_IFACE_PAR_DECL}
        end subroutine DLB_{MPI_NAME}_cdesc_enter

        subroutine DLB_{MPI_NAME}_cdesc_leave() &
                bind(c, name="DLB_{MPI_NAME}_cdesc_leave")
            implicit none
        end subroutine DLB_{MPI_NAME}_cdesc_leave
    end interface

    {F08_CSHIM_PRECALL_STMTS}

    call DLB_{MPI_NAME}_cdesc_enter({F08_CSHIM_ARGS})

    call {PMPI_NAME}({F08_ARGS}{F08_ARGS_SEPARATOR}f08_ierror)

    if (present(ierror)) ierror = f08_ierror

    call DLB_{MPI_NAME}_cdesc_leave()

end subroutine {MPI_NAME}_f08ts
#endif

!$PYGEN end

#endif /* MPI_LIB && FORTRAN_SUPPORTS_ASSUMED_RANK */
