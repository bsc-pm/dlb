#!/usr/bin/env sh

CC="@CC@"
VERSIONS="@TEST_VERSIONS@"
SRCDIR="@abs_top_srcdir@"
BLDDIR="@abs_top_builddir@"

@HAVE_HWLOC_TRUE@ HWLOC_CPPFLAGS="@HWLOC_CPPFLAGS@ -DHWLOC_LIB"
@HAVE_PAPI_TRUE@ PAPI_CPPFLAGS="@PAPI_CPPFLAGS@ -DPAPI_LIB"
CPPFLAGS="-DHAVE_CONFIG_H -I$BLDDIR \
            -I$SRCDIR/tests/test -I$SRCDIR/src -I$SRCDIR/src/apis \
            -I$SRCDIR/src/LB_core -I$BLDDIR/src $HWLOC_CPPFLAGS $PAPI_CPPFLAGS"
PERFO_CPPFLAGS="$CPPFLAGS @PERFO_CPPFLAGS@"
DEBUG_CPPFLAGS="$CPPFLAGS @DEBUG_CPPFLAGS@"

PERFO_CFLAGS="@PERFO_CFLAGS@ @AC_CFLAGS@ -include perish.h"
DEBUG_CFLAGS="@DEBUG_CFLAGS@ @AC_CFLAGS@ -include perish.h"

@HAVE_HWLOC_TRUE@ HWLOC_LDFLAGS="@HWLOC_LDFLAGS@ -Wl,-rpath,@HWLOC_LIBDIR@ -Wl,-enable-new-dtags"
@HAVE_PAPI_TRUE@ PAPI_LDFLAGS="@PAPI_LDFLAGS@ -Wl,-rpath,@PAPI_LIBDIR@ -Wl,-enable-new-dtags"
PERFO_LDFLAGS="$BLDDIR/.libs/libdlb.a $HWLOC_LDFLAGS $PAPI_LDFLAGS -lrt -ldl @AC_LDFLAGS@"
DEBUG_LDFLAGS="$BLDDIR/.libs/libdlb_dbg.a $HWLOC_LDFLAGS $PAPI_LDFLAGS -lrt -ldl @AC_LDFLAGS@"

cat << EOF
compile_versions="$VERSIONS"

test_CC="$CC"
test_CPPFLAGS_performance="$PERFO_CPPFLAGS"
test_CPPFLAGS_debug="$DEBUG_CPPFLAGS"
test_CFLAGS_performance="$PERFO_CFLAGS"
test_CFLAGS_debug="$DEBUG_CFLAGS"
test_LDFLAGS_performance="$PERFO_LDFLAGS"
test_LDFLAGS_debug="$DEBUG_LDFLAGS"

$($SRCDIR/tests/gens/config.py "$@")
EOF
