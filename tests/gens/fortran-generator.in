#!/usr/bin/env sh

FC="@FC@"
VERSIONS="@TEST_VERSIONS@"
SRCDIR="@abs_top_srcdir@"
BLDDIR="@abs_top_builddir@"

@HAVE_HWLOC_TRUE@ HWLOC_CPPFLAGS="@HWLOC_CPPFLAGS@ -DHWLOC_LIB"
@HAVE_PAPI_TRUE@ PAPI_CPPFLAGS="@PAPI_CPPFLAGS@ -DPAPI_LIB"
CPPFLAGS="-I$SRCDIR/tests/test -I$SRCDIR/src -I$SRCDIR/src/apis -I$SRCDIR/src/LB_core \
            -I$BLDDIR/src $HWLOC_CPPFLAGS $PAPI_CPPFLAGS"
PERFO_CPPFLAGS="$CPPFLAGS @PERFO_CPPFLAGS@"
DEBUG_CPPFLAGS="$CPPFLAGS @DEBUG_CPPFLAGS@"

PERFO_FCFLAGS="$PERFO_CPPFLAGS @PERFO_FCFLAGS@ @AC_FCFLAGS@"
DEBUG_FCFLAGS="$DEBUG_CPPFLAGS @DEBUG_FCFLAGS@ @AC_FCFLAGS@"

@HAVE_HWLOC_TRUE@ HWLOC_LDFLAGS="@HWLOC_LDFLAGS@ -Wl,-rpath,@HWLOC_LIBDIR@ -Wl,-enable-new-dtags"
@HAVE_PAPI_TRUE@ PAPI_LDFLAGS="@PAPI_LDFLAGS@ -Wl,-rpath,@PAPI_LIBDIR@ -Wl,-enable-new-dtags"
PERFO_LDFLAGS="$BLDDIR/.libs/libdlb.a $HWLOC_LDFLAGS $PAPI_LDFLAGS -lrt -ldl @AC_LDFLAGS@"
DEBUG_LDFLAGS="$BLDDIR/.libs/libdlb_dbg.a $HWLOC_LDFLAGS $PAPI_LDFLAGS -lrt -ldl @AC_LDFLAGS@"

@HAVE_FORTRAN_FALSE@ TEST_IGNORE=yes

cat << EOF
compile_versions="$VERSIONS"

test_FC="$FC"
test_CPPFLAGS_performance="$PERFO_CPPFLAGS"
test_CPPFLAGS_debug="$DEBUG_CPPFLAGS"
test_FCFLAGS_performance="$PERFO_FCFLAGS"
test_FCFLAGS_debug="$DEBUG_FCFLAGS"
test_LDFLAGS_performance="$PERFO_LDFLAGS"
test_LDFLAGS_debug="$DEBUG_LDFLAGS"
test_ignore=$TEST_IGNORE

$($SRCDIR/tests/gens/config.py "$@")
EOF
