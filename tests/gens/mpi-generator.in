#!/bin/bash

CC="@CC@"
VERSIONS="@TEST_VERSIONS@"
SRCDIR="@abs_top_srcdir@"
BLDDIR="@abs_top_builddir@"

@HAVE_HWLOC_TRUE@ HWLOC_CPPFLAGS="@HWLOC_CPPFLAGS@"
CPPFLAGS="-I$SRCDIR/src -I$SRCDIR/src/LB_core -I$BLDDIR/src $HWLOC_CPPFLAGS @MPI_CPPFLAGS@"
PERFO_CFLAGS="@PERFO_CFLAGS@ @AC_CFLAGS@ $CPPFLAGS"
DEBUG_CFLAGS="@DEBUG_CFLAGS@ @AC_CFLAGS@ $CPPFLAGS --debug"

@HAVE_HWLOC_TRUE@ HWLOC_LDFLAGS="@HWLOC_LDFLAGS@"
PERFO_LDFLAGS="$BLDDIR/.libs/libdlb.a $HWLOC_LDFLAGS -lrt @MPI_LDFLAGS@"
DEBUG_LDFLAGS="$BLDDIR/.libs/libdlb_dbg.a $HWLOC_LDFLAGS -lrt @MPI_LDFLAGS@"

MPIEXEC="@MPIEXEC@"
MPIEXEC_BIND_OPTS="@MPIEXEC_BIND_OPTS@"
@MPI_LIB_FALSE@ TEST_IGNORE=yes
@MPI_TESTS_FALSE@ TEST_IGNORE=yes

cat <<EOF
compile_versions="$VERSIONS"

test_CC="$CC"
test_CFLAGS_performance="$PERFO_CFLAGS"
test_CFLAGS_debug="$DEBUG_CFLAGS"
test_LDFLAGS_performance="$PERFO_LDFLAGS"
test_LDFLAGS_debug="$DEBUG_LDFLAGS"

test_ignore=$TEST_IGNORE
test_ENV="$MPIEXEC -n 2 $MPIEXEC_BIND_OPTS env"

$($SRCDIR/tests/gens/config.py "$@")
EOF
